"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const schematics_1 = require("@angular-devkit/schematics");
const cli_core_1 = require("@igniteui/cli-core");
const path_1 = require("path");
function default_1(options) {
    return (tree, _context) => {
        const config = options.projTemplate.generateConfig(options.name, options.theme);
        // update version with schematics one
        config.cliVersion = cli_core_1.Util.version((0, path_1.join)(__dirname, "../../package.json"));
        return (0, schematics_1.chain)([
            (_tree, context) => {
                context.logger.debug(`Project template: ${options.projTemplate.id}`);
            },
            ...options.projTemplate.templatePaths.map(templatePath => (0, schematics_1.mergeWith)((0, schematics_1.apply)((0, schematics_1.url)(cli_core_1.Util.relativePath(__filename, templatePath, true)), [
                (0, schematics_1.template)(config)
            ]), schematics_1.MergeStrategy.Overwrite)),
            (host, _hostContext) => {
                const content = host.read("./package.json").toString();
                host.overwrite("./package.json", content.replace(`"igniteui-cli":`, `"@igniteui/angular-schematics":`));
            }
        ]);
    };
}
exports.default = default_1;
